<div class="list-middle" (click)="closeMenuOnClickOutside($event)">
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p class="loading-text">Cargando cotizaciones...</p>
  </div>

  <div *ngIf="!isLoading && !hasSearched" class="empty-state">
    <p class="empty-title">{{ getEmptyMessage().title }}</p>
    <p class="empty-subtitle">{{ getEmptyMessage().subtitle }}</p>
  </div>

  <div *ngIf="!isLoading && hasSearched && quotations.length === 0" class="empty-state">
    <p class="empty-title">{{ getEmptyMessage().title }}</p>
    <p class="empty-subtitle">{{ getEmptyMessage().subtitle }}</p>
  </div>

  <table class="table" *ngIf="!isLoading && quotations.length > 0">
    <thead>
    <tr>
      <th class="header">Número</th>
      <th class="header">Estado</th>
      <th class="header">Usuario</th>
      <th class="header">Total</th>
      <th class="header">Items</th>
      <th class="header">Fecha Creación</th>
      <th class="header actions-header">Acciones</th>
    </tr>
    </thead>
    <tbody>
    <tr class="row" *ngFor="let quotation of quotations; trackBy: trackByQuotationId">
      <td class="cell" (click)="onRowClick(quotation.id)">
        <span class="code">{{ quotation.number }}</span>
      </td>

      <td class="cell" (click)="onRowClick(quotation.id)">
        <span [class]="getBadgeClass(quotation.status)">{{ quotation.status }}</span>
      </td>

      <td class="cell" (click)="onRowClick(quotation.id)">
        <span class="label">{{ quotation.username || '-' }}</span>
      </td>

      <td class="cell" (click)="onRowClick(quotation.id)">
        <span class="value amount">{{ quotation.totalAmount }}</span>
      </td>

      <td class="cell" (click)="onRowClick(quotation.id)">
        <span class="value">{{ quotation.itemCount }}</span>
      </td>

      <td class="cell" (click)="onRowClick(quotation.id)">
        <span class="value datetime">{{ formatDateTime(quotation.createdAt) }}</span>
      </td>

      <td class="cell actions-cell">
        <div class="actions">
          <button type="button"
                  class="action-menu-btn"
                  (click)="toggleMenu(quotation.id, $event)"
                  [disabled]="quotation.isProcessing"
                  [class.active]="isMenuOpen(quotation.id)"
                  title="Acciones disponibles">
            <span class="dots" *ngIf="!quotation.isProcessing">⋮</span>
            <div *ngIf="quotation.isProcessing" class="mini-spinner"></div>
          </button>

          <div class="action-menu"
               *ngIf="isMenuOpen(quotation.id)"
               (click)="$event.stopPropagation()">

            <ng-container *ngIf="quotation.status === 'DRAFT'">
              <button class="menu-item"
                      (click)="onConfirmClick(quotation); closeMenu()"
                      [disabled]="quotation.isProcessing">
                <span class="menu-text">Confirmar Cotización</span>
              </button>

              <button class="menu-item danger"
                      (click)="onCancelClick(quotation); closeMenu()"
                      [disabled]="quotation.isProcessing">
                <span class="menu-text">Cancelar Cotización</span>
              </button>
            </ng-container>

            <ng-container *ngIf="quotation.status === 'CONFIRMED'">
              <div class="menu-item disabled">
                <span class="menu-text">Cotización Confirmada</span>
              </div>
            </ng-container>

            <ng-container *ngIf="quotation.status === 'CANCELED'">
              <div class="menu-item disabled">
                <span class="menu-text">Cotización Cancelada</span>
              </div>
            </ng-container>
          </div>
        </div>
      </td>
    </tr>
    </tbody>
  </table>
</div>
