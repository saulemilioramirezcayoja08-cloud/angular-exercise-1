<div class="list-middle" (click)="closeMenuOnClickOutside($event)">
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p class="loading-text">Cargando órdenes...</p>
  </div>

  <div *ngIf="!isLoading && !hasSearched" class="empty-state">
    <p class="empty-title">{{ getEmptyMessage().title }}</p>
    <p class="empty-subtitle">{{ getEmptyMessage().subtitle }}</p>
  </div>

  <div *ngIf="!isLoading && hasSearched && orders.length === 0" class="empty-state">
    <p class="empty-title">{{ getEmptyMessage().title }}</p>
    <p class="empty-subtitle">{{ getEmptyMessage().subtitle }}</p>
  </div>

  <div class="table-container" *ngIf="!isLoading && orders.length > 0">
    <table class="table">
      <thead>
      <tr>
        <th class="header">Número</th>
        <th class="header">Estado</th>
        <th class="header">Usuario</th>
        <th class="header">Total</th>
        <th class="header">Anticipos</th>
        <th class="header">Items</th>
        <th class="header">Fecha Creación</th>
        <th class="header actions-header">Acciones</th>
      </tr>
      </thead>
      <tbody>
      <tr class="row" *ngFor="let order of orders; trackBy: trackByOrderId">
        <td class="cell" (click)="onRowClick(order.id)">
          <span class="code">{{ order.number }}</span>
        </td>

        <td class="cell" (click)="onRowClick(order.id)">
          <span [class]="getBadgeClass(order.status)">{{ order.status }}</span>
        </td>

        <td class="cell" (click)="onRowClick(order.id)">
          <span class="label">{{ order.username || '-' }}</span>
        </td>

        <td class="cell" (click)="onRowClick(order.id)">
          <span class="value amount">{{ order.totalAmount }}</span>
        </td>

        <td class="cell" (click)="onRowClick(order.id)">
          <span class="value amount">{{ order.totalAdvances }}</span>
        </td>

        <td class="cell" (click)="onRowClick(order.id)">
          <span class="value">{{ order.itemCount }}</span>
        </td>

        <td class="cell" (click)="onRowClick(order.id)">
          <span class="value datetime">{{ formatDateTime(order.createdAt) }}</span>
        </td>

        <td class="cell actions-cell">
          <div class="actions">
            <button type="button"
                    class="action-menu-btn"
                    (click)="toggleMenu(order.id, $event)"
                    [disabled]="order.isProcessing"
                    [class.active]="isMenuOpen(order.id)"
                    title="Acciones disponibles">
              <span class="dots" *ngIf="!order.isProcessing">⋮</span>
              <div *ngIf="order.isProcessing" class="mini-spinner"></div>
            </button>

            <div class="action-menu"
                 *ngIf="isMenuOpen(order.id)"
                 (click)="$event.stopPropagation()">

              <button class="menu-item"
                      (click)="onPrintClick(order); closeMenu()"
                      [disabled]="order.isProcessing">
                <span class="menu-text">Imprimir</span>
              </button>

              <ng-container *ngIf="order.status === 'DRAFT'">
                <div class="menu-divider"></div>

                <button class="menu-item"
                        (click)="onAdvanceClick(order); closeMenu()"
                        [disabled]="order.isProcessing">
                  <span class="menu-text">Agregar Anticipo</span>
                </button>

                <button class="menu-item"
                        (click)="onConfirmClick(order); closeMenu()"
                        [disabled]="order.isProcessing">
                  <span class="menu-text">Confirmar Orden</span>
                </button>

                <button class="menu-item danger"
                        (click)="onCancelClick(order); closeMenu()"
                        [disabled]="order.isProcessing">
                  <span class="menu-text">Cancelar Orden</span>
                </button>
              </ng-container>

              <ng-container *ngIf="order.status === 'CONFIRMED'">
                <div class="menu-divider"></div>
                <div class="menu-item disabled">
                  <span class="menu-text">Orden Confirmada</span>
                </div>
              </ng-container>

              <ng-container *ngIf="order.status === 'CANCELED'">
                <div class="menu-divider"></div>
                <div class="menu-item disabled">
                  <span class="menu-text">Orden Cancelada</span>
                </div>
              </ng-container>
            </div>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
