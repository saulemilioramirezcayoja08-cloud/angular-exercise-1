<div class="list-middle" (click)="closeMenuOnClickOutside($event)">
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p class="loading-text">Cargando ventas...</p>
  </div>

  <div *ngIf="!isLoading && !hasSearched" class="empty-state">
    <p class="empty-title">{{ getEmptyMessage().title }}</p>
    <p class="empty-subtitle">{{ getEmptyMessage().subtitle }}</p>
  </div>

  <div *ngIf="!isLoading && hasSearched && sales.length === 0" class="empty-state">
    <p class="empty-title">{{ getEmptyMessage().title }}</p>
    <p class="empty-subtitle">{{ getEmptyMessage().subtitle }}</p>
  </div>

  <table class="table" *ngIf="!isLoading && sales.length > 0">
    <thead>
    <tr>
      <th class="header">Número</th>
      <th class="header">Estado</th>
      <th class="header">Usuario</th>
      <th class="header">Total Venta</th>
      <th class="header">Items</th>
      <th class="header">ID Orden</th>
      <th class="header">Anticipos</th>
      <th class="header">Fecha Creación</th>
      <th class="header actions-header">Acciones</th>
    </tr>
    </thead>
    <tbody>
    <tr class="row" *ngFor="let sale of sales; trackBy: trackBySaleId">

      <td class="cell" (click)="onRowClick(sale.id)">
        <span class="code">{{ sale.number }}</span>
      </td>

      <td class="cell" (click)="onRowClick(sale.id)">
        <span [class]="getBadgeClass(sale.status)">{{ sale.status }}</span>
      </td>

      <td class="cell" (click)="onRowClick(sale.id)">
        <span class="label">{{ sale.username || '-' }}</span>
      </td>

      <td class="cell" (click)="onRowClick(sale.id)">
        <span class="value amount">{{ sale.saleTotalAmount }}</span>
      </td>

      <td class="cell" (click)="onRowClick(sale.id)">
        <span class="value">{{ sale.itemCount }}</span>
      </td>

      <td class="cell" (click)="onRowClick(sale.id)">
        <span class="code">{{ sale.orderId }}</span>
      </td>

      <td class="cell" (click)="onRowClick(sale.id)">
        <span class="value amount">{{ sale.orderTotalAdvances }}</span>
      </td>

      <td class="cell" (click)="onRowClick(sale.id)">
        <span class="value datetime">{{ formatDateTime(sale.createdAt) }}</span>
      </td>

      <td class="cell actions-cell">
        <div class="actions">
          <button type="button"
                  class="action-menu-btn"
                  (click)="toggleMenu(sale.id, $event)"
                  [disabled]="sale.isProcessing"
                  [class.active]="isMenuOpen(sale.id)"
                  title="Acciones disponibles">
            <span class="dots" *ngIf="!sale.isProcessing">⋮</span>
            <div *ngIf="sale.isProcessing" class="mini-spinner"></div>
          </button>

          <div class="action-menu"
               *ngIf="isMenuOpen(sale.id)"
               (click)="$event.stopPropagation()">

            <button class="menu-item"
                    (click)="onPrintClick(sale); closeMenu()"
                    [disabled]="sale.isProcessing">
              <span class="menu-text">Imprimir Venta</span>
            </button>

            <ng-container *ngIf="sale.status === 'DRAFT'">
              <div class="menu-divider"></div>

              <button class="menu-item"
                      (click)="onAdvanceClick(sale); closeMenu()"
                      [disabled]="sale.isProcessing">
                <span class="menu-text">Agregar Anticipo</span>
              </button>

              <button class="menu-item"
                      (click)="onConfirmClick(sale); closeMenu()"
                      [disabled]="sale.isProcessing">
                <span class="menu-text">Confirmar Venta</span>
              </button>

              <button class="menu-item danger"
                      (click)="onCancelClick(sale); closeMenu()"
                      [disabled]="sale.isProcessing">
                <span class="menu-text">Cancelar Venta</span>
              </button>
            </ng-container>

            <ng-container *ngIf="sale.status === 'CONFIRMED'">
              <div class="menu-divider"></div>

              <button class="menu-item"
                      (click)="onAdvanceClick(sale); closeMenu()"
                      [disabled]="sale.isProcessing">
                <span class="menu-text">Agregar Anticipo</span>
              </button>

              <div class="menu-divider"></div>

              <div class="menu-item disabled">
                <span class="menu-text">Venta Confirmada</span>
              </div>
            </ng-container>

            <ng-container *ngIf="sale.status === 'CANCELED'">
              <div class="menu-divider"></div>
              <div class="menu-item disabled">
                <span class="menu-text">Venta Cancelada</span>
              </div>
            </ng-container>
          </div>
        </div>
      </td>
    </tr>
    </tbody>
  </table>
</div>
